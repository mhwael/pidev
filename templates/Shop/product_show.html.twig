<!doctype html>
<html lang="zxx">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>View & Order</title>

    <base href="/front_template/">

    <link rel="icon" href="img/favicon.png">
    <link rel="stylesheet" href="css/bootstrap.min.css">
    <link rel="stylesheet" href="css/style.css">

    <style>
        .navbar-brand img { height: 44px !important; width: auto !important; object-fit: contain; }

        /* ✅ Whole page background */
        .body_bg{
            position: relative;
            min-height: 100vh;
            background: url("img/latest_war_img_1.png") center/cover no-repeat fixed;
        }
        /* if your file is jpg, change to latest_war_img_1.jpg */
        .body_bg::before{
            content:"";
            position:absolute;
            inset:0;
            background: linear-gradient(135deg, rgba(0,0,0,.72), rgba(0,0,0,.40));
            pointer-events:none;
            z-index:0;
        }
        .body_bg > *{ position:relative; z-index:1; }

        .section_padding{ padding: 45px 0 80px !important; }

        /* Layout cards */
        .panel{
            background: rgba(255,255,255,.95);
            border: 1px solid rgba(255,255,255,.20);
            border-radius: 18px;
            box-shadow: 0 18px 55px rgba(0,0,0,.28);
            backdrop-filter: blur(8px);
            overflow: hidden;
        }
        .panel-inner{ padding: 18px; }

        /* Product media */
        .media-wrap{
            background: linear-gradient(180deg,#f6f7f9,#ffffff);
            border-radius: 16px;
            height: 360px;
            display:flex;
            align-items:center;
            justify-content:center;
            padding: 16px;
            position: relative;
            overflow: hidden;
        }
        .media-wrap img{
            width:100%;
            height:100%;
            object-fit: contain;
        }
        .media-placeholder{
            width:100%;
            height:100%;
            display:flex;
            align-items:center;
            justify-content:center;
            color:#777;
        }

        /* Badges */
        .pill{
            display:inline-flex;
            align-items:center;
            gap:8px;
            padding:7px 11px;
            border-radius:999px;
            font-weight:900;
            font-size:.78rem;
            background: rgba(13,110,253,.12);
            color:#0d6efd;
        }
        .pill.gray{
            background: rgba(108,117,125,.12);
            color:#6c757d;
        }

        .stock-badge{
            position:absolute;
            top:14px;
            right:14px;
            padding:7px 10px;
            border-radius:999px;
            font-weight:900;
            font-size:.78rem;
            display:inline-flex;
            align-items:center;
            gap:8px;
            box-shadow:0 10px 18px rgba(0,0,0,.15);
        }
        .stock-in{ background: rgba(25,135,84,.92); color:#fff; }
        .stock-low{ background: rgba(255,193,7,.95); color:#111; }
        .stock-out{ background: rgba(220,53,69,.95); color:#fff; }

        /* Product text */
        .p-title{ font-weight: 900; font-size: 1.6rem; margin: 12px 0 6px; color:#111; }
        .p-desc{ color:#6c757d; margin: 0; line-height: 1.55; }
        .price{
            font-weight: 900;
            font-size: 1.25rem;
            color:#111;
        }
        .divider{
            height:1px;
            background: rgba(0,0,0,.08);
            margin: 14px 0;
        }

        /* Order form */
        .form-label{ font-weight: 800; margin-bottom: 6px; }
        .form-control{
            border-radius: 12px;
            border: 1px solid rgba(0,0,0,.12);
            height: 46px;
        }
        textarea.form-control{ height:auto; }
        .form-control:focus{
            border-color: rgba(13,110,253,.50);
            box-shadow: 0 0 0 .2rem rgba(13,110,253,.15);
        }
        .btn_1{
            border-radius: 999px;
            font-weight: 900;
            letter-spacing: .2px;
        }

        .help-note{
            color:#6c757d;
            font-size:.92rem;
            margin-top: 12px;
        }
    </style>
</head>

<body>
<div class="body_bg">

    <header class="main_menu single_page_menu">
        <div class="container">
            <nav class="navbar navbar-expand-lg navbar-light">
                <a class="navbar-brand" href="/">
                    <img src="img/levelup_logo.png" alt="LevelUp">
                </a>

                <div class="collapse navbar-collapse main-menu-item">
                    <ul class="navbar-nav">
                        <li class="nav-item"><a class="nav-link" href="{{ path('shop_products') }}">Shop</a></li>
                        <li class="nav-item"><a class="nav-link" href="{{ path('my_orders') }}">My Orders</a></li>
                    </ul>
                </div>

                <a href="{{ path('shop_products') }}" class="btn_1 d-none d-sm-block">Back To Shop</a>
            </nav>
        </div>
    </header>

    <section class="section_padding">
        <div class="container">

            {% for msg in app.flashes('error') %}
                <div class="alert alert-danger">{{ msg }}</div>
            {% endfor %}

            <div class="panel">
                <div class="panel-inner">
                    <div class="row g-4 align-items-start">

                        <!-- LEFT: Product -->
                        <div class="col-lg-6">
                            <div class="media-wrap">

                                {# ✅ Stock badge (only if stock exists) #}
                                {% if product.stock is defined %}
                                    {% if product.stock <= 0 %}
                                        <span class="stock-badge stock-out">Out of stock</span>
                                    {% elseif product.stock <= 5 %}
                                        <span class="stock-badge stock-low">Low ({{ product.stock }})</span>
                                    {% else %}
                                        <span class="stock-badge stock-in">In stock</span>
                                    {% endif %}
                                {% endif %}

                                {% set imgSrc = null %}
                                {% if product.image %}
                                    {% if product.image starts with('http') or product.image starts with('/') %}
                                        {% set imgSrc = product.image %}
                                    {% else %}
                                        {% set imgSrc = asset('uploads/products/' ~ product.image) %}
                                    {% endif %}
                                {% endif %}

                                {% if imgSrc %}
                                    <img src="{{ imgSrc }}" alt="{{ product.name }}"
                                         onerror="this.onerror=null;this.src='{{ asset('uploads/products/placeholder.png') }}';">
                                {% else %}
                                    <div class="media-placeholder">No image</div>
                                {% endif %}
                            </div>

                            <div class="mt-3 d-flex flex-wrap gap-2">
                                <span class="pill">{{ product.category ?? 'Uncategorized' }}</span>
                                <span class="pill gray">Secure checkout</span>
                                <span class="pill gray">Fast delivery</span>
                            </div>

                            <div class="p-title">{{ product.name }}</div>

                            <div class="d-flex align-items-center justify-content-between flex-wrap gap-2">
                                <div class="price">
                                    {{ (product.price ?? 0)|number_format(2, '.', '') }} TND
                                </div>

                                {% if product.stock is defined %}
                                    <div class="text-muted font-weight-bold">
                                        Stock: {{ product.stock }}
                                    </div>
                                {% endif %}
                            </div>

                            <div class="divider"></div>

                            <p class="p-desc">
                                {{ product.description ?? 'No description.' }}
                            </p>
                        </div>

                        <!-- RIGHT: Order Form -->
                        <div class="col-lg-6">
                            <div class="panel" style="box-shadow:none;">
                                <div class="panel-inner">
                                    <h4 class="mb-3" style="font-weight:900;color:#111;">Your information</h4>

                                    <form method="post"
                                          action="{{ path('shop_order_product', {id: product.id}) }}"
                                          novalidate>

                                        <div class="row">
                                            <div class="col-md-6 mb-3">
                                                <label class="form-label">First Name</label>
                                                <input class="form-control" name="firstName" placeholder="Your first name">
                                            </div>
                                            <div class="col-md-6 mb-3">
                                                <label class="form-label">Last Name</label>
                                                <input class="form-control" name="lastName" placeholder="Your last name">
                                            </div>
                                        </div>

                                        <div class="mb-3">
                                            <label class="form-label">Phone</label>
                                            <input class="form-control" name="phone" placeholder="+216 ...">
                                        </div>

                                        <div class="mb-4">
                                            <label class="form-label">Email</label>
                                            <input type="email" class="form-control" name="email" placeholder="you@example.com">
                                        </div>

                                        {% if product.stock is defined and product.stock <= 0 %}
                                            <div class="alert alert-warning mb-3">
                                                This product is currently out of stock.
                                            </div>
                                            <button class="btn_1 w-100" type="button" disabled style="opacity:.6;">
                                                Out of Stock
                                            </button>
                                        {% else %}
                                            <button class="btn_1 w-100" type="submit">
                                                <i class="fas fa-shopping-cart mr-2"></i> Confirm Order
                                            </button>
                                        {% endif %}

                                        <p class="help-note mb-0">
                                            By confirming, your order will appear in <b>My Orders</b>.
                                        </p>
                                    </form>
                                </div>
                            </div>
                        </div>

                    </div>
                </div>
            </div>

        </div>
    </section>

</div>

<script src="js/jquery-1.12.1.min.js"></script>
<script src="js/popper.min.js"></script>
<script src="js/bootstrap.min.js"></script>
</body>
</html>
